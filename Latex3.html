<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>LaTeX Preview</title>
  <script src="https://cdn.jsdelivr.net/npm/latex.js/dist/latex.min.js"></script>
</head>
<body>
  <h1>LaTeX Preview</h1>
  <p>Enter your LaTeX code below:</p>
  
  <textarea id="latex-input" rows="10" cols="50" style="display: block;"></textarea>
  <button id="convert-button">Convert</button>
  
  <h2>Preview:</h2>
  <div id="preview-output" style="border: 1px solid #ccc; padding: 1em; min-height: 2em;"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var convertButton = document.getElementById("convert-button");

      // Custom macro handler for \bibitem
      class BibitemMacroHandler {
        constructor() {
          this.env = new latexjs.Environment();
        }

        invoke(parser, symbol) {
          let reference = parser.parseArg();
          let marker = new latexjs.Marker();
          this.env.marker(marker);
          this.env.label(reference);

          return new latexjs.Frag([
            marker,
            new latexjs.Span([new latexjs.Text('[' + reference + ']')], {classes: 'bibitem'})
          ]);
        }
      }

      // Convert LaTeX input to HTML using latex.js with custom macro handler
      function convertLaTeXToHTML(input) {
        var generator = new latexjs.HtmlGenerator({hyphenate: false});
        var parser = new latexjs.default(generator);
        
        // Add the custom macro handler for \bibitem
        parser.setMacro("bibitem", new BibitemMacroHandler());

        return parser.parse(input);
      }

      convertButton.addEventListener("click", function() {
        var input = document.getElementById("latex-input").value;
        var output = document.getElementById("preview-output");
        try {
          var htmlOutput = convertLaTeXToHTML(input);
          output.innerHTML = '';
          output.appendChild(htmlOutput);
          output.style.color = 'black';
        } catch (error) {
          output.innerHTML = 'Error: ' + error.message;
          output.style.color = 'red';
        }
      });
    });
  </script>
</body>
</html>